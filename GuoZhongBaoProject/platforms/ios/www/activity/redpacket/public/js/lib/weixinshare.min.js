(function(A){function w(a,g,e){var f=0,b=[0],c="",d=null,c=e||"UTF8";if("UTF8"!==c&&"UTF16BE"!==c&&"UTF16LE"!==c){throw"encoding must be UTF8, UTF16BE, or UTF16LE"}if("HEX"===g){if(0!==a.length%2){throw"srcString of HEX type must be in byte increments"}d=r(a);f=d.binLen;b=d.value}else{if("TEXT"===g||"ASCII"===g){d=s(a,c),f=d.binLen,b=d.value}else{if("B64"===g){d=t(a),f=d.binLen,b=d.value}else{if("BYTES"===g){d=u(a),f=d.binLen,b=d.value}else{throw"inputFormat must be HEX, TEXT, ASCII, B64, or BYTES"}}}}this.getHash=function(m,j,D,o){var l=null,i=b.slice(),k=f,h;3===arguments.length?"number"!==typeof D&&(o=D,D=1):2===arguments.length&&(D=1);if(D!==parseInt(D,10)||1>D){throw"numRounds must a integer >= 1"}switch(j){case"HEX":l=v;break;case"B64":l=x;break;case"BYTES":l=y;break;default:throw"format must be HEX, B64, or BYTES"}if("SHA-1"===m){for(h=0;h<D;h+=1){i=p(i,k),k=160}}else{throw"Chosen SHA variant is not supported"}return l(i,z(o))};this.getHMAC=function(i,h,j,k,H){var l,m,G,I,o=[],J=[];l=null;switch(k){case"HEX":k=v;break;case"B64":k=x;break;case"BYTES":k=y;break;default:throw"outputFormat must be HEX, B64, or BYTES"}if("SHA-1"===j){m=64,I=160}else{throw"Chosen SHA variant is not supported"}if("HEX"===h){l=r(i),G=l.binLen,l=l.value}else{if("TEXT"===h||"ASCII"===h){l=s(i,c),G=l.binLen,l=l.value}else{if("B64"===h){l=t(i),G=l.binLen,l=l.value}else{if("BYTES"===h){l=u(i),G=l.binLen,l=l.value}else{throw"inputFormat must be HEX, TEXT, ASCII, B64, or BYTES"}}}}i=8*m;h=m/4-1;if(m<G/8){if("SHA-1"===j){l=p(l,G)}else{throw"Unexpected error in HMAC implementation"}for(;l.length<=h;){l.push(0)}l[h]&=4294967040}else{if(m>G/8){for(;l.length<=h;){l.push(0)}l[h]&=4294967040}}for(m=0;m<=h;m+=1){o[m]=l[m]^909522486,J[m]=l[m]^1549556828}if("SHA-1"===j){j=p(J.concat(p(o.concat(b),i+f)),i+I)}else{throw"Unexpected error in HMAC implementation"}return k(j,z(H))}}function s(f,e){var a=[],d,g=[],h=0,i,b,c;if("UTF8"===e){for(i=0;i<f.length;i+=1){for(d=f.charCodeAt(i),g=[],128>d?g.push(d):2048>d?(g.push(192|d>>>6),g.push(128|d&63)):55296>d||57344<=d?g.push(224|d>>>12,128|d>>>6&63,128|d&63):(i+=1,d=65536+((d&1023)<<10|f.charCodeAt(i)&1023),g.push(240|d>>>18,128|d>>>12&63,128|d>>>6&63,128|d&63)),b=0;b<g.length;b+=1){for(c=h>>>2;a.length<=c;){a.push(0)}a[c]|=g[b]<<24-h%4*8;h+=1}}}else{if("UTF16BE"===e||"UTF16LE"===e){for(i=0;i<f.length;i+=1){d=f.charCodeAt(i);"UTF16LE"===e&&(b=d&255,d=b<<8|d>>8);for(c=h>>>2;a.length<=c;){a.push(0)}a[c]|=d<<16-h%4*8;h+=2}}}return{value:a,binLen:8*h}}function r(a){var f=[],d=a.length,e,b,c;if(0!==d%2){throw"String of HEX type must be in byte increments"}for(e=0;e<d;e+=2){b=parseInt(a.substr(e,2),16);if(isNaN(b)){throw"String of HEX type contains invalid characters"}for(c=e>>>3;f.length<=c;){f.push(0)}f[e>>>3]|=b<<24-e%8*4}return{value:f,binLen:4*d}}function u(a){var e=[],c,d,b;for(d=0;d<a.length;d+=1){c=a.charCodeAt(d),b=d>>>2,e.length<=b&&e.push(0),e[b]|=c<<24-d%4*8}return{value:e,binLen:8*a.length}}function t(a){var h=[],e=0,g,b,c,d,f;if(-1===a.search(/^[a-zA-Z0-9=+\/]+$/)){throw"Invalid character in base-64 string"}b=a.indexOf("=");a=a.replace(/\=/g,"");if(-1!==b&&b<a.length){throw"Invalid '=' found in base-64 string"}for(b=0;b<a.length;b+=4){f=a.substr(b,4);for(c=d=0;c<f.length;c+=1){g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[c]),d|=g<<18-6*c}for(c=0;c<f.length-1;c+=1){for(g=e>>>2;h.length<=g;){h.push(0)}h[g]|=(d>>>16-8*c&255)<<24-e%4*8;e+=1}}return{value:h,binLen:8*e}}function v(a,f){var d="",e=4*a.length,b,c;for(b=0;b<e;b+=1){c=a[b>>>2]>>>8*(3-b%4),d+="0123456789abcdef".charAt(c>>>4&15)+"0123456789abcdef".charAt(c&15)}return f.outputUpper?d.toUpperCase():d}function x(a,g){var e="",f=4*a.length,b,c,d;for(b=0;b<f;b+=3){for(d=b+1>>>2,c=a.length<=d?0:a[d],d=b+2>>>2,d=a.length<=d?0:a[d],d=(a[b>>>2]>>>8*(3-b%4)&255)<<16|(c>>>8*(3-(b+1)%4)&255)<<8|d>>>8*(3-(b+2)%4)&255,c=0;4>c;c+=1){e=8*b+6*c<=32*a.length?e+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>>6*(3-c)&63):e+g.b64Pad}}return e}function y(a){var e="",c=4*a.length,d,b;for(d=0;d<c;d+=1){b=a[d>>>2]>>>8*(3-d%4)&255,e+=String.fromCharCode(b)}return e}function z(a){var c={outputUpper:!1,b64Pad:"="};try{a.hasOwnProperty("outputUpper")&&(c.outputUpper=a.outputUpper),a.hasOwnProperty("b64Pad")&&(c.b64Pad=a.b64Pad)}catch(b){}if("boolean"!==typeof c.outputUpper){throw"Invalid outputUpper formatting option"}if("string"!==typeof c.b64Pad){throw"Invalid b64Pad formatting option"}return c}function B(a,b){return a<<b|a>>>32-b}function n(a,c){var b=(a&65535)+(c&65535);return((a>>>16)+(c>>>16)+(b>>>16)&65535)<<16|b&65535}function q(a,f,d,e,b){var c=(a&65535)+(f&65535)+(d&65535)+(e&65535)+(b&65535);return((a>>>16)+(f>>>16)+(d>>>16)+(e>>>16)+(b>>>16)+(c>>>16)&65535)<<16|c&65535}function p(f,e){var j=[],c,g,h,i,l,d,b,m,a,k=[1732584193,4023233417,2562383102,271733878,3285377520];for(c=(e+65>>>9<<4)+15;f.length<=c;){f.push(0)}f[e>>>5]|=128<<24-e%32;f[c]=e;a=f.length;for(b=0;b<a;b+=16){c=k[0];g=k[1];h=k[2];
    i=k[3];l=k[4];for(m=0;80>m;m+=1){j[m]=16>m?f[m+b]:B(j[m-3]^j[m-8]^j[m-14]^j[m-16],1),d=20>m?q(B(c,5),g&h^~g&i,l,1518500249,j[m]):40>m?q(B(c,5),g^h^i,l,1859775393,j[m]):60>m?q(B(c,5),g&h^g&i^h&i,l,2400959708,j[m]):q(B(c,5),g^h^i,l,3395469782,j[m]),l=i,i=h,h=B(g,30),g=c,c=d}k[0]=n(c,k[0]);k[1]=n(g,k[1]);k[2]=n(h,k[2]);k[3]=n(i,k[3]);k[4]=n(l,k[4])}return k}"function"===typeof define&&define.amd?define(function(){return w}):"undefined"!==typeof exports?"undefined"!==typeof module&&module.exports?module.exports=exports=w:exports=w:A.jsSHA=w})(this);var weixinShare=function(){var e=e||{},f=f||{},d=d||{};f=function(k,c){e.getWxTicket();var b=d.ticket,j=(new Date()).valueOf(),a="jsapi_ticket="+b+"&noncestr=weixinshare&timestamp="+j+"&url="+window.location.href,l=e.calcSignature(a);console.log(b);console.log(a);console.log(l);wx.config({debug:false,appId:k,timestamp:j,nonceStr:"weixinshare",signature:l,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage"]});wx.ready(function(){wx.checkJsApi({jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"]});wx.onMenuShareTimeline({title:c.shareTimeline_title,link:c.shareTimeline_link,imgUrl:c.shareTimeline_image,success:function(){c.shareTimeline_success()},cancel:function(){c.shareTimeline_cancel()}});wx.onMenuShareAppMessage({title:c.shareAppMessage_title,desc:c.shareAppMessage_description,link:c.shareAppMessage_link,imgUrl:c.shareAppMessage_image,type:"",dataUrl:"",success:function(){c.shareAppMessage_success()},cancel:function(){c.shareAppMessage_cancel()}})})};e.getWxTicket=function(){$.ajax({url:"http://test.node.renrenfenqi.com/interface/gzb/weChat/getTicket",type:"GET",async:false,success:function(a){var c=eval("("+a+")");if(c.status==200){d=c.data}},error:function(a){console.log("get ticket error:"+a)}})};e.calcSignature=function(a){var b=new jsSHA(a,"TEXT");return b.getHash("SHA-1","HEX")};return{shareMain:f,utilities:e}}();
